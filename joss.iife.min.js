// Copyright (c) 2021 Tee Teik Wynn (w.tee@wynntee.com)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
// 
const JOSS=function(){"use strict";const e=function(){const e=new ArrayBuffer(2);new Uint16Array(e)[0]=65279;return 254===new Uint8Array(e)[0]?"BE":"LE"}(),t={Object:f,Array:f,Map:f,Set:f,DataView:c,Int8Array:c,Uint8Array:c,Uint8ClampedArray:c,Int16Array:c,Uint16Array:c,Int32Array:c,Uint32Array:c,Float32Array:c,Float64Array:c,BigInt64Array:c,BigUint64Array:c,Date:function(e,t){p(e,Uint8Array.of(14)),n(e,t.valueOf())},RegExp:function(e,t){p(e,Uint8Array.of(15)),n(e,t.toString())},ArrayBuffer:i,SharedArrayBuffer:i,Boolean:o,Number:a,BigInt:s,String:i},r={hole:new Error("Encountered a hole in a sparse array"),ended:new Error("The serialized bytestream ended before the deserialization could complete successfully."),unused:new Error("The deserialization completed before the end of the serialized bytestream."),exceeded:new Error("The serialized bytestream exceeded the maximum acceptable length."),malformed:new Error("The serialized bytestream contained malformed byte sequences."),property:new Error("Encountered an undefined property of a collection."),collection:new Error("Encountered a collection in streaming mode.")};return r.ended.name="ERR_ENDED",r.unused.name="ERR_UNUSED",r.exceeded.name="ERR_EXCEEDED",r.malformed.name="ERR_MALFORMED",void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^\(\s\/]*)\s*/)[1]}}),Uint8Array.of=Uint8Array.of||function(){const e=new this(arguments.length);return e.set(Array.prototype.slice.call(arguments)),e},Uint8Array.from=Uint8Array.from||function(){const e=new this(arguments[0].length);return e.set(arguments[0]),e},Uint8Array.prototype.forEach=Uint8Array.prototype.forEach||Array.prototype.forEach,{serialize:function(t,r){const o={};if(void 0===r)r={};else if("object"!=typeof r)throw new TypeError("The options parameter must be an object.");if(!1===r.hasOwnProperty("endian"))o.endian=e;else{if("LE"!==r.endian&&"BE"!==r.endian)throw new RangeError('The endian option must be either "LE" or "BE".');o.endian=r.endian}return o.bytes=[],o.length=0,o.record=new Map,o.method="static",n(o,t),g(o.bytes,o.length)},deserialize:function(e){if("object"!=typeof e||"Uint8Array"!==e.constructor.name)throw new TypeError("The bytes parameter must be a Uint8Array.");const t={};t.map=new Map,t.bytes=e,t.cursor=0,t.offset=0,t.method="static";const n=d(t);if(t.cursor!==t.bytes.length)throw r.unused;return n},serializable:function(t,o){const a={};if(void 0===o)o={};else if("object"!=typeof o)throw new TypeError("The options parameter must be an object.");if(!1===o.hasOwnProperty("endian"))a.endian=e;else{if("LE"!==o.endian&&"BE"!==o.endian)throw new RangeError('The endian option must be either "LE" or "BE".');a.endian=o.endian}a.length=0,a.record=new Map,a.method="stream";const s=[],i=[],f=[],c=Symbol(),l=Symbol(),h=Symbol();return new ReadableStream({start:function(e){s.push(0),i.push({root:t}),f.push(y(i[0]))},pull:function(e){const t=i.length-1;if(t>=0){a.bytes=[];const o=s[t],d=i[t],b=f[t].next();if(0===o){let e;e=128;const r=d.constructor.name;if("Array"===r){const t=u(d.length);if(d.hasOwnProperty(l)){e=160;const r=u(d[l]);p(a,Uint8Array.of(0|e|t.length-1<<2|r.length-1)),p(a,t),p(a,r)}else if(d.hasOwnProperty(h)){e=160;const r=u(d[h]);p(a,Uint8Array.of(16|e|t.length-1<<2|r.length-1)),p(a,t),p(a,r)}else{u(d.length);p(a,Uint8Array.of(e|t.length-1)),p(a,t)}}else if("Object"===r&&0!==t){const t=u(d[c]);p(a,Uint8Array.of(8|e|t.length-1)),p(a,t)}else if("Map"===r){const t=u(d.size);p(a,Uint8Array.of(16|e|t.length-1)),p(a,t)}else if("Set"===r){const t=u(d.size);p(a,Uint8Array.of(24|e|t.length-1)),p(a,t)}}if(!1===b.done){if(2!==o){const e=b.value,o=d.constructor.name;if("Array"===o&&d.hasOwnProperty(h))n(a,e);else if("Object"===o&&0!==t)n(a,e);else if("Map"===o)try{n(a,e)}catch(t){if(t!==r.collection)throw t;s.push(0),i.push(e),f.push(y(e))}s[t]=2}else if(2===o){const e=b.value;if(e!==r.hole)try{n(a,e)}catch(t){if(t!==r.collection)throw t;s.push(0),i.push(e),f.push(y(e))}else d.hasOwnProperty(l)&&p(a,Uint8Array.of(12));s[t]=1}}else delete d[h],delete d[l],delete d[c],s.pop(),i.pop(),f.pop();0!==a.bytes.length?e.enqueue(g(a.bytes)):this.pull(e)}else e.close()}});function y(e){let t,n,o,a;n="key";const s=e.constructor.name;if("Array"===s){a=e.keys();const t=A(e);void 0!==t.nslot?Object.defineProperty(e,l,{configurable:!0,value:t.nslot}):void 0!==t.nelement&&Object.defineProperty(e,h,{configurable:!0,value:t.nelement})}else"Object"===s?(a=Object.keys(e),Object.defineProperty(e,c,{configurable:!0,value:a.length}),o=-1):"Map"!==s&&"Set"!==s||(a=e.keys());return{next:function(){if("key"===n){if(n="value",void 0===o){let r=a.next();if(e.hasOwnProperty(h))for(;!1===e.hasOwnProperty(r.value)&&!1===r.done;)r=a.next();return!1===r.done?(t=r.value,e.hasOwnProperty(l)&&t>=e[l]?{value:void 0,done:!0}:{value:t,done:!1}):{value:void 0,done:!0}}return o+=1,void 0!==a[o]?(t=a[o],{value:t,done:!1}):{value:void 0,done:!0}}if(n="key","Array"===s)return e.hasOwnProperty(t)?{value:e[t],done:!1}:{value:r.hole,done:!1};if("Object"===s)return{value:e[t],done:!1};if("Map"===s)return{value:e.get(t),done:!1};if("Set"===s)return{value:t,done:!1}}}}},deserializable:function(e){let t;if(void 0===e)e={};else if("object"!=typeof e)throw new TypeError("The options parameter must be an object.");if(!1===e.hasOwnProperty("maxlength"))t=1073741824;else{if(!("number"==typeof e.maxlength&&e.maxlength>0))throw new RangeError("The maxlength option must be a positive integer.");t=e.maxlength}const r=w(t),n=new WritableStream(r);return r.stream=n,n},deserializing:function(e,t){let r;if(void 0===t)t={};else if("object"!=typeof t)throw new TypeError("The options parameter must be an object.");if(!1===t.hasOwnProperty("maxlength"))r=1073741824;else{if(!("number"==typeof t.maxlength&&t.maxlength>0))throw new RangeError("The maxlength option must be a positive integer.");r=t.maxlength}if("object"==typeof e){if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator](),n=w(r);return n.start(),new Promise((function(e,r){t.next().then((function o(a){!1===a.done?(n.write(a.value),t.next().then(o).catch(r)):e(n.close())})).catch(r)}))}if("ReadableStream"===e.constructor.name){const t=e.getReader(),n=w(r);return n.start(),new Promise((function(e,r){t.read().then((function o(a){!1===a.done?(n.write(a.value),t.read().then(o).catch(r)):e(n.close())})).catch(r)}))}throw new TypeError("The readable parameter must be a readable stream or async iterable.")}throw new TypeError("The readable parameter must be a readable stream or async iterable.")}};function n(e,r){switch(typeof r){case"object":if(null!==r){const n=r.constructor.name,o=t[n];return void 0!==o?!1===e.record.has(r)?(e.record.set(r,e.length),o(e,r,n)):l(e,r):p(e,Uint8Array.of(13))}return p(e,Uint8Array.of(0));case"undefined":return p(e,Uint8Array.of(1));case"boolean":return o(e,r);case"number":return a(e,r);case"bigint":return s(e,r);case"string":return i(e,r);default:p(e,Uint8Array.of(13))}}function o(e,t,r){void 0===r?p(e,!0===t?Uint8Array.of(2):Uint8Array.of(4)):!0===t.valueOf()?p(e,Uint8Array.of(3)):p(e,Uint8Array.of(5))}function a(e,t,r){let n,o,a;if(n=32,void 0===r){if(a=t,!isFinite(a))return p(e,a===1/0?Uint8Array.of(6):a===-1/0?Uint8Array.of(8):Uint8Array.of(10))}else{if(a=t.valueOf(),!isFinite(a))return p(e,a===1/0?Uint8Array.of(7):a===-1/0?Uint8Array.of(9):Uint8Array.of(11));n|=16}Math.floor(a)===a&&Math.abs(a)<=Number.MAX_SAFE_INTEGER?((a<0||0===a&&1/a==-1/0)&&(n|=8),o=u(Math.abs(a))):(o=new Uint8Array(new ArrayBuffer(8)),new DataView(o.buffer,o.byteOffset,o.byteOffset+o.length).setFloat64(0,a,!0)),p(e,Uint8Array.of(n|o.length-1)),p(e,o)}function s(e,t,r){let n,o,a;n=64,void 0===r?a=t:(a=t.valueOf(),n|=16),a>=0?o=h(a):(n|=8,o=h(-a));const s=u(o.length);p(e,Uint8Array.of(n|s.length-1)),p(e,s),p(e,o)}function i(e,t,r,n,o){let a,s;a=96,void 0===r?s=y(t):"String"===r?(a|=8,s=y(t.valueOf())):(a|="ArrayBuffer"===r?16:24,s=new Uint8Array(t,n||0,o||t.byteLength));const i=u(s.length);p(e,Uint8Array.of(a|i.length-1)),p(e,i),p(e,s)}function f(e,t,o){if("stream"===e.method)throw r.collection;let a;if(a=128,"Array"===o){const r=u(t.length),o=A(t);if(void 0!==o.nslot){a=160;const s=o.nslot,i=u(s);p(e,Uint8Array.of(0|a|r.length-1<<2|i.length-1)),p(e,r),p(e,i);for(let r=0;r<s;r+=1)t.hasOwnProperty(r)?n(e,t[r]):p(e,Uint8Array.of(12))}else if(void 0!==o.nelement){a=160;const s=u(o.nelement);p(e,Uint8Array.of(16|a|r.length-1<<2|s.length-1)),p(e,r),p(e,s),t.forEach((function(t,r){n(e,r),n(e,t)}))}else{u(t.length);p(e,Uint8Array.of(a|r.length-1)),p(e,r),t.forEach((function(t){n(e,t)}))}}else if("Object"===o){const r=u(Object.keys(t).length);p(e,Uint8Array.of(8|a|r.length-1)),p(e,r);for(let r in t)t.hasOwnProperty(r)&&(n(e,r),n(e,t[r]))}else if("Map"===o){const r=u(t.size);p(e,Uint8Array.of(16|a|r.length-1)),p(e,r),t.forEach((function(t,r){n(e,r),n(e,t)}))}else{const r=u(t.size);p(e,Uint8Array.of(24|a|r.length-1)),p(e,r),t.forEach((function(t){n(e,t)}))}}function c(t,r,n){let o,a,s,f;if(o=192,"BE"===t.endian&&(o|=16),t.endian!==e&&r.BYTES_PER_ELEMENT>1){switch(a=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength),r.BYTES_PER_ELEMENT){case 2:a=U(a);break;case 4:a=v(a);break;case 8:a=E(a)}s=0,f=a.byteLength}else a=r.buffer,s=r.byteOffset,f=r.byteLength;p(t,Uint8Array.of(o|["DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"].indexOf(n))),!1===t.record.has(a)?(t.record.set(a,t.length),i(t,a,a.constructor.name,s,f)):l(t,a)}function l(e,t){p(e,Uint8Array.of(29)),a(e,e.record.get(t))}function u(e){const t=[];for(;e>255;)t.push(255&e),e=Math.floor(e/256);return t.push(e),Uint8Array.from(t)}function h(e){const t=[],r=BigInt(8),n=BigInt(255);for(;e>n;)t.push(Number(e&n)),e>>=r;return t.push(Number(e)),Uint8Array.from(t)}function y(e){try{return(new TextEncoder).encode(e)}catch(t){let r=0;const n=[],o=e.length;for(;r<o;){let t=e.charCodeAt(r++);if(t<=127)n.push(t);else if(t<=2047)n.push(t>>6&31|192),n.push(63&t|128);else if(t<=55295||t>=57344&&t<=65535)n.push(t>>12&15|224),n.push(t>>6&63|128),n.push(63&t|128);else{const o=t,a=e.charCodeAt(r++);if(o<55296||o>56319)continue;if(a<56320||a>57343)continue;t=(1023&o)<<10|1023&a,t+=65536,n.push(t>>18&7|240),n.push(t>>12&63|128),n.push(t>>6&63|128),n.push(63&t|128)}}return Uint8Array.from(n)}}function d(t){const n=t.bytes[t.cursor];if(void 0===n)throw r.ended;if(n<=13){let e;switch(t.cursor++,t.offset++,n){case 0:return null;case 1:return;case 2:return!0;case 3:e=new Boolean(!0);break;case 4:return!1;case 5:e=new Boolean(!1);break;case 6:return 1/0;case 7:e=new Number(1/0);break;case 8:return-1/0;case 9:e=new Number(-1/0);break;case 10:return NaN;case 11:e=new Number(NaN);break;case 12:return r.hole;case 13:return new ReferenceError}return t.map.set(t.offset-1,e),e}if(n<=31)switch(n){case 14:return function(e){const t=e.offset;e.cursor++,e.offset++;try{if(!1===function(e){const t=e.bytes[e.cursor];if(void 0===t)throw r.ended;return t>>5==1&&0==(t>>4&1)||10===t}(e))throw r.malformed;const n=new Date(d(e));return e.map.set(t,n),n}catch(t){throw t===r.ended?(e.cursor--,e.offset--,t):t}}(t);case 15:return function(e){const t=e.offset;e.cursor++,e.offset++;try{if(!1===P(e))throw r.malformed;const n=d(e),o=n.lastIndexOf("/");if("/"!==n[0]||o<=0)throw r.malformed;const a=new RegExp(n.slice(1,o),n.slice(o+1));return e.map.set(t,a),a}catch(t){throw t===r.ended?(e.cursor--,e.offset--,t):t}}(t);case 29:return function(e){e.cursor++,e.offset++;try{if(!1===O(e))throw r.malformed;const t=d(e);if(!1===e.map.has(t))throw r.malformed;return e.map.get(t)}catch(t){throw t===r.ended?(e.cursor--,e.offset--,t):t}}(t);default:throw r.malformed}else switch(n>>5){case 1:return function(e){let t,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw r.ended;if(a<8){if(7===a&&e.bytes[n+6]>31)throw r.malformed;t=b(e.bytes.subarray(n,n+=a)),1==(o>>3&1)&&(t*=-1)}else{const r=e.bytes.subarray(n,n+=a);t=new DataView(r.buffer,r.byteOffset,r.length).getFloat64(0,!0)}1==(o>>4&1)&&(t=new Number(t),e.map.set(e.offset,t));return e.cursor+=a+1,e.offset+=a+1,t}(t);case 2:return function(e){let t,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw r.ended;const s=b(e.bytes.subarray(n,n+=a));if(n+s>e.bytes.length)throw r.ended;t=function(e){const t=BigInt(0),r=BigInt(8);let n=t,o=t;return e.forEach((function(e){n+=BigInt(e)<<o,o+=r})),n}(e.bytes.subarray(n,n+=s)),1==(o>>3&1)&&(t*=BigInt(-1));1==(o>>4&1)&&(t=new Object(t),e.map.set(e.offset,t));return e.cursor+=a+s+1,e.offset+=a+s+1,t}(t);case 3:return function(e){let t,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw r.ended;const s=b(e.bytes.subarray(n,n+=a));if(n+s>e.bytes.length)throw r.ended;switch(o>>3&3){case 0:t=m(e.bytes,n,n+=s);break;case 1:t=new String(m(e.bytes,n,n+=s)),e.map.set(e.offset,t);break;case 2:t=new ArrayBuffer(s),e.map.set(e.offset,t),new Uint8Array(t).set(e.bytes.subarray(n,n+=s));break;case 3:t=new SharedArrayBuffer(s),e.map.set(e.offset,t),new Uint8Array(t).set(e.bytes.subarray(n,n+=s))}return e.cursor+=a+s+1,e.offset+=a+s+1,t}(t);case 4:return function(e){if("stream"===e.method)throw r.collection;let t,n=e.cursor;const o=e.bytes[n++],a=e.bytes.length,s=1+(7&o);if(n+s>a)throw r.ended;const i=b(e.bytes.subarray(n,n+=s));switch(o>>3&3){case 0:t=[],e.map.set(e.offset,t),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(k(e))throw r.malformed;t.push(d(e))}return t;case 1:t={},e.map.set(e.offset,t),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(!1===P(e))throw r.malformed;const n=d(e);if(t.hasOwnProperty(n))throw r.malformed;if(k(e))throw r.malformed;t[n]=d(e)}return t;case 2:t=new Map,e.map.set(e.offset,t),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){const n=d(e);if(t.has(n))throw r.malformed;if(k(e))throw r.malformed;t.set(n,d(e))}return t;case 3:t=new Set,e.map.set(e.offset,t),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(k(e))throw r.malformed;const n=d(e);if(t.has(n))throw r.malformed;t.add(n)}return t}}(t);case 5:return function(e){if("stream"===e.method)throw r.collection;let t=e.cursor;const n=e.bytes[t++],o=e.bytes.length,a=1+(n>>2&3);if(t+a>o)throw r.ended;const s=b(e.bytes.subarray(t,t+=a)),i=new Array(s),f=1+(3&n);if(t+f>o)throw r.ended;const c=b(e.bytes.subarray(t,t+=f));if(e.map.set(e.offset,i),e.cursor+=a+f+1,e.offset+=a+f+1,0==(n>>4&1)){for(let t=0;t<c;t+=1){const n=d(e);n!==r.hole&&(i[t]=n)}return i}for(let t=0;t<c;t+=1){if(!1===O(e))throw r.malformed;const t=d(e);if(t>=s)throw r.malformed;if(i.hasOwnProperty(t))throw r.malformed;if(k(e))throw r.malformed;i[t]=d(e)}return i}(t);case 6:return function(t){const n=t.offset,o=t.bytes[t.cursor],a=e!==(o>>4&1?"BE":"LE"),s=15&o;t.cursor++,t.offset++;try{let e;if(!1===function(e){const t=e.bytes[e.cursor];if(void 0===t)throw r.ended;return t>>5==3&&(t>>3&3)>=2}(t))throw r.malformed;const o=d(t);switch(s){case 0:e=new DataView(o);break;case 1:e=new Int8Array(o);break;case 2:e=new Uint8Array(o);break;case 3:e=new Uint8ClampedArray(o);break;case 4:e=a?new Int16Array(U(o.slice())):new Int16Array(o);break;case 5:e=a?new Uint16Array(U(o.slice())):new Uint16Array(o);break;case 6:e=a?new Int32Array(v(o.slice())):new Int32Array(o);break;case 7:e=a?new Uint32Array(v(o.slice())):new Uint32Array(o);break;case 8:e=a?new Float32Array(v(o.slice())):new Float32Array(o);break;case 9:e=a?new Float64Array(E(o.slice())):new Float64Array(o);break;case 10:e=a?new BigInt64Array(E(o.slice())):new BigInt64Array(o);break;case 11:e=a?new BigUint64Array(E(o.slice())):new BigUint64Array(o);break;default:throw r.malformed}return t.map.set(n,e),e}catch(e){throw e===r.ended?(t.cursor--,t.offset--,e):e}}(t);case 7:throw r.malformed}}function b(e){let t=0,r=0;return e.forEach((function(e){t+=e*Math.pow(2,r),r+=8})),t}function m(e,t,r){try{return new TextDecoder("utf-8").decode(e.subarray(t,r))}catch(n){let o=t,a="";for(;o<r;){let t;if(0===e[o])break;if(0==(128&e[o]))a+=String.fromCharCode(e[o++]);else if(192==(224&e[o])&&o+1<r)t=(31&e[o++])<<6|63&e[o++],a+=String.fromCharCode(t);else if(224==(240&e[o])&&o+2<r)t=(15&e[o++])<<12|(63&e[o++])<<6|63&e[o++],a+=String.fromCharCode(t);else{if(!(240==(248&e[o])&&o+3<r))break;if(t=(7&e[o++])<<18|(63&e[o++])<<12|(63&e[o++])<<6|63&e[o++],t>65535){t-=65536;const e=t>>>10&1023|55296,r=1023&t|56320;a+=String.fromCharCode(e,r)}else a+=String.fromCharCode(t)}}return a}}function w(e){const t={},n=[{}],o=Symbol(),a=Symbol(),s=Symbol(),i=Symbol(),f=Symbol(),c=Symbol();return{start:function(e){t.map=new Map,t.bytes=new Uint8Array(0),t.cursor=0,t.offset=0,t.length=0,t.method="stream",Object.defineProperty(n[0],a,{configurable:!0,value:1}),Object.defineProperty(n[0],o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(n[0],s,{configurable:!0,writable:!0,value:"root"})},close:function(e){if(t.bytes.length>0){if(void 0===e)throw r.unused;e.error(r.unused)}else{const e=n[0].root;if(delete n[0].root,void 0===this.stream)return e;this.stream.result=e,delete this.stream}},write:function(h,y){let m;if((t.length+=h.length)<=e){t.bytes=g([t.bytes,h]);const e=t.bytes.length;let y=n.length-1;for(;y>=0;){const h=n[y],w=u(h);if(w===r.property)try{if(t.cursor+1>e)break;let a=d(t);if(a!==r.hole){if(l(h,a),0===y)break;if(n.pop(),n[y-1][s]===f){if(n[y-1].has(w))throw r.malformed;n[y-1][s]=a}}else{if("A"!==h[i])throw r.malformed;h[o]++,n.pop()}}catch(n){if(n!==r.collection){n!==r.ended&&(m=n);break}{let r=t.cursor;const n=t.bytes[r++];if(n>>5==4){let i;const f=1+(7&n);if(r+f>e)break;const c=b(t.bytes.subarray(r,r+=f));switch(n>>3&3){case 0:i=[];break;case 1:i={};break;case 2:i=new Map;break;case 3:i=new Set}Object.defineProperty(i,a,{configurable:!0,value:c}),Object.defineProperty(i,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(i,s,{configurable:!0,writable:!0,value:void 0}),l(h,i),t.map.set(t.offset,i),t.cursor+=f+1,t.offset+=f+1}else if(n>>5==5){const f=1+(n>>2&3);if(r+f>e)break;const c=b(t.bytes.subarray(r,r+=f)),u=new Array(c),y=1+(3&n);if(r+y>e)break;const d=b(t.bytes.subarray(r,r+=y));Object.defineProperty(u,a,{configurable:!0,value:d}),Object.defineProperty(u,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(u,s,{configurable:!0,writable:!0,value:void 0}),Object.defineProperty(u,i,{configurable:!0,value:0==(n>>4&1)?"A":"B"}),l(h,u),t.map.set(t.offset,u),t.cursor+=f+y+1,t.offset+=f+y+1}}}else if(w[o]<w[a]){const e=w.constructor.name;if("Array"===e)if("B"!==w[i])w[s]=w[o],n.push(w);else try{if(!1===O(t))throw r.malformed;const e=d(t);if(e>=w.length)throw r.malformed;if(w.hasOwnProperty(e))throw r.malformed;w[s]=e,n.push(w)}catch(e){e!==r.ended&&(m=e);break}else if("Object"===e)try{if(!1===P(t))throw r.malformed;const e=d(t);if(w.hasOwnProperty(e))throw r.malformed;w[s]=e,n.push(w)}catch(e){e!==r.ended&&(m=e);break}else if("Map"===e){w[s]=f,n.push(w);const e={};Object.defineProperty(e,a,{configurable:!0,value:1}),Object.defineProperty(e,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(e,s,{configurable:!0,writable:!1,value:"root"}),n.push(e)}else"Set"===e&&(w[s]=c,n.push(w))}else{if(delete w[i],delete w[s],delete w[o],delete w[a],0===y)break;if(n.pop(),n[y-1][s]===f){if(n[y-1].has(w))throw r.malformed;n[y-1][s]=w}}y=n.length-1}void 0===m&&(t.bytes=t.bytes.slice(t.cursor),t.cursor=0)}else m=r.exceeded;if(void 0!==m){if(void 0===y)throw m;y.error(m)}}};function l(e,t){const n=e.constructor.name;if("Array"===n)e.hasOwnProperty(i)?(e[e[s]]=t,e[o]++):(e.push(t),e[o]++);else if("Object"===n)e[e[s]]=t,e[o]++;else if("Map"===n)e.set(e[s],t),e[o]++;else if("Set"===n){if(e.has(t))throw r.malformed;e.add(t),e[s]=t,e[o]++}}function u(e){const t=e[s],n=e.constructor.name;return"Array"===n||"Object"===n?e.hasOwnProperty(t)?e[t]:r.property:"Map"===n?e.has(t)?e.get(t):r.property:"Set"===n?e.has(t)?t:r.property:void 0}}function p(e,t){e.bytes.push(t),e.length+=t.length}function g(e,t){let r=0,n=0;void 0===t?e.forEach((function(e){r+=e.length})):r=t;const o=new Uint8Array(r);return e.forEach((function(e){o.set(e,n),n+=e.length})),o}function A(e){let t=0,r=0,n=0,o=0,a=-1;e.forEach((function(e,s){a=s,s<=65535?s<=255?t++:r++:s<=1677215?n++:o++})),a+=1;const s=t+r+n+o;if(s===e.length)return{};return a-s<=2*t+3*r+4*n+5*o?{nslot:a}:{nelement:s}}function U(e){const t=new Uint8Array(e);for(let e=0,r=t.length;e<r;e+=2){const r=t[e];t[e]=t[e+1],t[e+1]=r}return e}function v(e){const t=new Uint8Array(e);for(let e=0,r=t.length;e<r;e+=4)for(let r=0;r<2;r+=1){const n=t[e+r];t[e+r]=t[e+3-r],t[e+3-r]=n}return e}function E(e){const t=new Uint8Array(e);for(let e=0,r=t.length;e<r;e+=8)for(let r=0;r<4;r+=1){const n=t[e+r];t[e+r]=t[e+7-r],t[e+7-r]=n}return e}function O(e){const t=e.bytes[e.cursor];if(void 0===t)throw r.ended;return t>>5==1&&0==(t>>4&1)&&0==(t>>3&1)}function k(e){const t=e.bytes[e.cursor];if(void 0===t)throw r.ended;return 12===t}function P(e){const t=e.bytes[e.cursor];if(void 0===t)throw r.ended;return t>>5==3&&0==(t>>3&3)}}();